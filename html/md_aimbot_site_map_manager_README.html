<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GAEMI0: SLAM 매뉴얼</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gaemi2.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GAEMI0
   &#160;<span id="projectnumber">0.12.0-rc1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_aimbot_site_map_manager_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SLAM 매뉴얼 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr  />
<ul>
<li>처음 들어가는 건물에서 Localization을 가능하게 하기 위한 맵 작성</li>
<li>절차 개요<ol type="1">
<li><a href="https://www.notion.so/SLAM-ba5795e18c6a4535ad9f08c22c275b44">Mapping 모드로 집개미 셋업</a></li>
<li><a href="https://www.notion.so/SLAM-ba5795e18c6a4535ad9f08c22c275b44">Mapping을 위한 주행</a></li>
<li><a href="https://www.notion.so/SLAM-ba5795e18c6a4535ad9f08c22c275b44">저장 및 후처리</a></li>
<li><a href="https://www.notion.so/SLAM-ba5795e18c6a4535ad9f08c22c275b44">(OPTIONAL) 테스트 주행</a></li>
</ol>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md38"></a>
Mapping 모드로 집개미 셋업</h1>
<p>Mapping을 하는 동안에 맵과는 상관없는 서비스를 전부 종료하고 Rviz에 맵과 관련된 메세지만 시각화하도록 세팅. → 필수 패키지 : aimbot_bringup, urg_node, aimbot_teleop</p>
<ol type="1">
<li><b>startup application 진입</b></li>
</ol>
<p><img src="doc/img/Untitled.png" alt="Untitled" class="inline"/></p>
<ol type="1">
<li><b>ZIP7H01 AutoStart 클릭</b></li>
</ol>
<p><img src="doc/img/Screenshot_from_2022-06-07_16-11-44.png" alt="Screenshot from 2022-06-07 16-11-44.png" class="inline"/></p>
<ol type="1">
<li><b>“Command”란의 명령어 수정</b><ul>
<li><p class="startli">Default:</p>
<p class="startli">```bash bash -ic "ros2 run aimbot_task_manager service_manager_node auto_start_robotis.xml” ```</p>
</li>
<li><p class="startli">수정 이후</p>
<p class="startli">```bash bash -ic "ros2 run aimbot_task_manager service_manager_node auto_start_core.xml” ```</p>
</li>
</ul>
</li>
<li>**(Optional) odom frame을 읽지 않도록 설정**<ol type="a">
<li>HOW TO: “**~/colcon_ws/src/aimbot_base/aimbot_bringup/controllers/diff_drive_controller.yaml”** 안에 <code>enable_odom_tf</code> 파라미터를 <code>false</code>로 설정</li>
<li>바로 mapping을 해도 상관 없으나 rviz상에서 TF가 어지럽게 움직일 여지가 있어 false로 두는 것이 추천됨.</li>
</ol>
</li>
<li><b>재부팅 <code>reboot</code></b></li>
</ol>
<h1><a class="anchor" id="autotoc_md39"></a>
Mapping을 위한 주행</h1>
<ol type="1">
<li><b>터미널에 <code>aimbot_slam</code> 명령어로 rviz와 함께 cartographer 시작</b></li>
<li>맵의 정확도를 높이기 위해 다음과 같은 방법이 추천됨.<ul>
<li><p class="startli">같은 장소라도 <b>회전을 자주</b> 해줄 것.</p><ul>
<li>grid map의 장애물 정보의 정확도를 높이는 효과 + 로봇의 위치에 대한 신뢰도 증가</li>
</ul>
<p class="startli"><img src="doc/img/Untitled%201.png" alt="Untitled" class="inline"/></p>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md40"></a>
저장 및 후처리</h1>
<ol type="1">
<li><p class="startli"><b>맵 제작 완료 후 저장</b></p>
<p class="startli">```bash ros2 run nav2_map_server map_saver_cli -f [맵 이름] ```</p><ul>
<li><p class="startli">[맵 이름].pgm, [맵 이름].yaml 파일로 저장됨.</p><ul>
<li>pgm 파일</li>
</ul>
<p class="startli"><img src="doc/img/Untitled%202.png" alt="Untitled" class="inline"/></p><ul>
<li>yaml 파일</li>
</ul>
<p class="startli">```yaml image: floor_test_map.pgm mode: trinary resolution: 0.05 origin: [-13.2, -23.6, 0] negate: 0 occupied_thresh: 0.65 free_thresh: 0.25 ```</p>
</li>
</ul>
</li>
<li>**<code>gimp</code>(리눅스), <code>paint.net</code>(윈도우) 등등의 이미지 편집툴을 이용하여 pgm파일을 편집**<ul>
<li>pgm 파일을 png 파일로 변환, yaml의 image 이름 수정(xxx.pgm → xxx.png)</li>
<li>크기, 회전 및 상하좌우 정렬<ul>
<li>크기: SLAM 맵의 크기를 따라 건물도면을 확대/축소</li>
<li>회전, 종횡, 정렬: 건물도면을 따라 SLAM 맵을 정렬</li>
</ul>
</li>
<li>각 층별 이미지를 레이어로 쌓아서 겹치게 세팅 → 전체 사이즈 결정<ul>
<li><p class="startli">추천 기준점 : EV 위치</p>
<p class="startli"><img src="doc/img/Untitled%203.png" alt="Untitled" class="inline"/></p>
</li>
</ul>
</li>
<li>원점은 이미지 최하단 좌측으로 설정 [TODO]</li>
<li>맵 리터칭<ul>
<li>색상별 속성</li>
<li>불필요한 장애물 제거(흰색 [RGB: 255, 255, 255])<ul>
<li>가지 말아야 할 영역 unknown 설정(회색 [RGB: 205, 205, 205])</li>
<li>맵이 잘 안그려진 부분 벽 설정(검은색 [RGB: 0, 0, 0])</li>
</ul>
</li>
<li>진행 순서<ul>
<li>1) 접근 제한 영역 표시<ul>
<li>장애물은 없으나 가지 못하게하고 싶은 영역:<ul>
<li><p class="startli">회색으로 채색 [이미지 펴기/접기]</p>
<p class="startli"><img src="doc/img/Untitled%204.png" alt="Untitled" class="inline"/></p>
<p class="startli"><img src="doc/img/Untitled%205.png" alt="Untitled" class="inline"/></p>
</li>
</ul>
</li>
<li>진입을 제한하나 추후 진입가능성이 있는 곳:<ul>
<li><p class="startli">회색 바를 삽입하여 제한선 설정 [이미지 펴기/접기]</p>
<p class="startli"><img src="doc/img/Untitled%206.png" alt="Untitled" class="inline"/></p>
<p class="startli"><img src="doc/img/Untitled%207.png" alt="Untitled" class="inline"/></p>
</li>
<li>유리도 같은 방식으로 처리</li>
</ul>
</li>
</ul>
</li>
<li>2) 주행 가능공간 노이즈를 흰색으로 처리<ul>
<li>라이다에 잡혔으나 추후 이동가능한 물체(e.g. 우산, 사람, 가방)</li>
<li>외에 노이즈로 잡힌 검은/회색영역<ul>
<li><p class="startli">예시 [이미지 펴기/접기]</p>
<p class="startli"><img src="doc/img/Untitled%208.png" alt="Untitled" class="inline"/></p>
<p class="startli"><img src="doc/img/Untitled%209.png" alt="Untitled" class="inline"/></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md41"></a>
map_manager 설정(aimbot_site)</h1>
<p>디렉토리 구조 </p><div class="fragment"><div class="line">map_manager/</div>
<div class="line">├── launch/</div>
<div class="line">│   ├── map_manager_[사이트 이름1].launch.xml</div>
<div class="line">│   ├── ...</div>
<div class="line">│   └── map_manager_[사이트 이름n].launch.xml</div>
<div class="line">├── map_data/</div>
<div class="line">│   ├── [사이트 이름1]/</div>
<div class="line">│   │   ├── maps/</div>
<div class="line">│   │   │   ├── 1st_floor.png</div>
<div class="line">│   │   │   ├── 1st_floor.yaml</div>
<div class="line">│   │   │   ├── ...</div>
<div class="line">│   │   │   ├── Nth_floor.png</div>
<div class="line">│   │   │   └── Nth_floor.png</div>
<div class="line">│   │   │</div>
<div class="line">│   │   ├── buttons.yaml</div>
<div class="line">│   │   ├── map_info.yaml</div>
<div class="line">│   │   ├── poi.yaml</div>
<div class="line">│   │   └── sectors.yaml</div>
<div class="line">│   │</div>
<div class="line">│   ├── ...</div>
<div class="line">│   └── [사이트 이름n]/</div>
<div class="line">├── params/</div>
<div class="line">│   ├── params_[사이트 이름1].yaml</div>
<div class="line">│   ├── ...</div>
<div class="line">│   └── params_[사이트 이름n].yaml</div>
<div class="line">└── ...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
map_manager_[사이트 이름].launch.xml 파일 작성</h2>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">launch</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Arguments --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;param_file_name&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;params_[사이트이름].yaml&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;params_file&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;$(find-pkg-share map_manager)/params/$(var param_file_name)&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">arg</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;use_sim_time&quot;</span> <span class="keyword">default</span>=<span class="stringliteral">&quot;false&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">&lt;!-- state_manger --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">node</span> <span class="keyword">pkg</span>=<span class="stringliteral">&quot;map_manager&quot;</span> <span class="keyword">exec</span>=<span class="stringliteral">&quot;map_manager_node&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">from</span>=<span class="stringliteral">&quot;$(var params_file)&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">node</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">launch</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
params_[사이트 이름1].yaml 파일 작성</h2>
<div class="fragment"><div class="line">map_manager:</div>
<div class="line">    ros__parameters:</div>
<div class="line">    map_data_set_name: [사이트이름]</div>
<div class="line">    robot_base_frame_id: base_link</div>
<div class="line">    robot_map_frame_id: map_current</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
map_data 작성</h2>
<h3><a class="anchor" id="autotoc_md45"></a>
buttons : 엘리베이터 버튼 정보</h3>
<div class="fragment"><div class="line">0:</div>
<div class="line">    name: 1_1</div>
<div class="line">    floor:</div>
<div class="line">    - 1</div>
<div class="line">    - 2</div>
<div class="line">    - 3</div>
<div class="line">    - 4</div>
<div class="line">    - 5</div>
<div class="line">    - 6</div>
<div class="line">    - 7</div>
<div class="line">    pose:</div>
<div class="line">    x: 0.306</div>
<div class="line">    y: -2.585</div>
<div class="line">    z: 0.9429999999999999</div>
<div class="line">    yaw: 180</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md46"></a>
map_info.yaml : 각 맵 사이의 연결 정보</h3>
<div class="fragment"><div class="line">map_id :</div>
<div class="line">  text : 1층</div>
<div class="line">  parent_id : map</div>
<div class="line">  frame_id : map_id</div>
<div class="line">  topic_name : /map_id</div>
<div class="line">  map_file : [map_manager, map_data, robotis, maps, map_id.yaml]  </div>
<div class="line">  #[package name, sub folder, ... , file name]</div>
<div class="line">  tf_origin : [x_offset, y_offset, z_offset]</div>
<div class="line">  init_pose : [init_x, init_y, init_theta]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md47"></a>
poi.yaml :</h3>
<ul>
<li>작성 정보<ul>
<li>uuid : 임의의 중복되지 않는 코드 생성</li>
<li>key: 소스코드 상의 변수명으로 사용될 이름</li>
<li>name: 앱에서 사용자에게 보여질 위치 이름</li>
<li>floor: key가 존재하는 층 정보</li>
<li>sector: key가 존재하는 구역 정보</li>
<li>pose: key의 물리적인 위치 좌표</li>
<li>x: 지도의 기준점으로부터 x좌표 거리(meter)</li>
<li>y: 지도의 기준점으로부터 y좌표 거리(meter)</li>
<li>theta: +X 축 방향을 0도 기준으로 반시계방향 각도값(degree)</li>
<li>type: DOCKING_STATION(충전스테이션), WAYPOINT(목적지로 표시되지 않는 경유지), DESTINATION(배송, 호출 등이 가능한 목적지) 중 선택</li>
<li>last_action: 그곳헤서 행동할 동작을 작성(추후 적용예정) ```yaml 06de07e9-7c70-e37d-4354-2e8ca413581a: # uuid key: docking_station name: 충전스테이션 floor: 1 sector: inside pose: x: 1.6 y: 0.3 theta: 0 type: DOCKING_STATION last_action: NO_ACTION ```</li>
</ul>
</li>
<li>필수 poi : 아래의 poi는 사이트 추가시 반드시 설정해야함 (key를 기준으로 작성)<ul>
<li>docking_station : docking_station은 벽을 바라보고 설치되며, 벽으로부터 0.35m 떨어진 위치로 설정</li>
<li>service_base : 충전기 도킹을 시작하는 위치. docking_station에서 0.4m 떨어진 위치로 설정</li>
<li>base : 배송을 시작하기 위해 로봇을 호출하는 위치</li>
<li>ev_outside_button : EV 버튼을 누르는 위치. 패널에서 0.7m 떨어진 위치로 설정</li>
<li>ev_outside_wait : EV 탑승을 대기하는 장소. EV 정중앙에서 2m 떨어진 위치로 설정</li>
<li>ev_inside_button : EV 버튼을 누르기 좋은 위치 선정. 패널에서 0.7m 떨어진 위치로 설정</li>
<li>ev_inside_wait : EV 하차 대기위치. 하차방향을 바라보도록 ev_inside_button에서 theta 값만 변경</li>
<li>ev_outside_exit : EV 하차위치. 로봇이 ev에서 내리는 위치로 ev_outside_wait과 동일한 위치 추천</li>
<li>security_door : 보안문이 닫혔을 때의 위치. theta값 미사용</li>
<li>security_door_outside : 외측에서 보안문이 열렸는지 판단하고 통신하는 위치. sector값 사용</li>
<li>security_door_inside : 내측에서 보안문이 열렸는지 판단하고 통신하는 위치 sector값 사용</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md48"></a>
sectors.yaml : 각 맵의 구역 정보</h3>
<ol type="1">
<li>sector를 체크할때 번호가 낮은 순서(상단)부터 해당 조건에 만족되는지 체크하여 내려가게됩니다. ( if, else if ,,, 와 같다고 생각하시면 됩니다.)</li>
<li>lines를 작성할때 반드시 박스형태로 a,b,c,f 모두 작성할 필요는 없고, lines 갯수는 몇개든 상관없습니다. (lines내에서 and 로 묶여있다고 보면 되겠습니다.)</li>
<li>floor와 lines의 수식을 모두 만족하면 name이 sector로 설정됩니다. 하나의 층에 하나의 sector가 한번만 작성될 필요가 없습니다.</li>
</ol>
<div class="fragment"><div class="line"># 현재 파일은 테스트를 위한 예시</div>
<div class="line">base:</div>
<div class="line">    name: base</div>
<div class="line">    floor: 1</div>
<div class="line">    lines:</div>
<div class="line">    a: [1.0, 0.0, 2.5]      # x + 2.5 &gt;= 0 : x &gt;= -2.5</div>
<div class="line">    b: [-1.0, 0.0, -1.0]    # -x - 1.0 &gt;= 0 : -1.0 &gt;= x</div>
<div class="line">    c: [0.0, -1.0, 1.5]     # -y + 1.5 &gt;= 0 : 1.5 &gt;= y</div>
<div class="line">    d: [0.0, 1.0, -0.5]     # y - 0.5 &gt;= 0 : y &gt;= 0.5</div>
<div class="line">1:</div>
<div class="line">    name: inside</div>
<div class="line">    floor: 1</div>
<div class="line">    lines:</div>
<div class="line">    a: [0.0, 1.0, -1.65]    # y - 1.65 &gt;= 0 : y &gt;= 1.65</div>
<div class="line"> </div>
<div class="line">default_sector: outside</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
navigation 설정</h2>
<ul>
<li>launch 파일 작성<ul>
<li><code>default_map_file_name</code> : 기본 맵</li>
</ul>
</li>
<li>rviz 열기 : <a class="el" href="namespaceaimbot__rviz.html">aimbot_rviz</a></li>
<li>rviz 설정<ul>
<li>fixed_frame : map → map_current</li>
</ul>
</li>
<li>초기위치<ul>
<li>init_pose</li>
</ul>
</li>
<li>주행 테스트<ul>
<li>Navigation2 Goal 도구</li>
</ul>
</li>
<li>(추가) aimbot_control_gui (aimbot_remote) : 맵 변경 등 지원 툴</li>
<li>launch 파일</li>
<li>config/parameter.xx.yaml<ul>
<li>floor 세팅<ul>
<li>map_1, map_2, …, map_10 → [”1”, “2”, …, “10”]</li>
</ul>
</li>
</ul>
</li>
<li>층 변경<ul>
<li>aimbot_remote_gui<ul>
<li>주행탭 → 층 선택 후 변경 클릭 </li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
